!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs/operator/first"),require("rxjs/operator/switchMap"),require("rxjs/operator/map"),require("rxjs/operator/catch"),require("rxjs/observable/throw"),require("@angular/core"),require("@angular/router"),require("@angular/common/http"),require("rxjs/Subject")):"function"==typeof define&&define.amd?define("ngx-auth",["exports","rxjs/operator/first","rxjs/operator/switchMap","rxjs/operator/map","rxjs/operator/catch","rxjs/observable/throw","@angular/core","@angular/router","@angular/common/http","rxjs/Subject"],t):t(e["ngx-auth"]={},e.Rx.Observable.prototype,e.Rx.Observable.prototype,e.Rx.Observable.prototype,e.Rx.Observable.prototype,e.Rx.Observable,e.ng.core,e.ng.router,e.ng.common.http,e.Rx)}(this,function(e,t,r,n,a,i,o,s,u,c){"use strict";var p=function(){};function h(e){return t.first.call(e)}function f(e,t){return r.switchMap.call(e,t)}function l(e,t){return n.map.call(e,t)}var d=new o.InjectionToken("AUTH_SERVICE"),g=new o.InjectionToken("PUBLIC_FALLBACK_PAGE_URI"),y=new o.InjectionToken("PROTECTED_FALLBACK_PAGE_URI"),v=function(){function e(e,t,r){this.authService=e,this.protectedFallbackPageUri=t,this.router=r}return e.prototype.canActivate=function(e,t){var r=this;return l(this.authService.isAuthorized(),function(e){return!(e&&!r.isProtectedPage(t))||(r.navigate(r.protectedFallbackPageUri),!1)})},e.prototype.canActivateChild=function(e,t){return this.canActivate(e,t)},e.prototype.isProtectedPage=function(e){return e.url===this.protectedFallbackPageUri},e.prototype.navigate=function(e){e.startsWith("http")?window.location.href=e:this.router.navigateByUrl(e)},e}();v.decorators=[{type:o.Injectable}],v.ctorParameters=function(){return[{type:p,decorators:[{type:o.Inject,args:[d]}]},{type:undefined,decorators:[{type:o.Inject,args:[y]}]},{type:s.Router}]};var b=function(){function e(e,t,r){this.authService=e,this.publicFallbackPageUri=t,this.router=r}return e.prototype.canActivate=function(e,t){var r=this;return l(this.authService.isAuthorized(),function(e){return!(!e&&!r.isPublicPage(t))||(r.navigate(r.publicFallbackPageUri),!1)})},e.prototype.canActivateChild=function(e,t){return this.canActivate(e,t)},e.prototype.isPublicPage=function(e){return e.url===this.publicFallbackPageUri},e.prototype.navigate=function(e){e.startsWith("http")?window.location.href=e:this.router.navigateByUrl(e)},e}();b.decorators=[{type:o.Injectable}],b.ctorParameters=function(){return[{type:p,decorators:[{type:o.Inject,args:[d]}]},{type:undefined,decorators:[{type:o.Inject,args:[g]}]},{type:s.Router}]};var j=function(){function e(e){this.injector=e,this.refreshInProgress=!1,this.refreshSubject=new c.Subject}return e.prototype.intercept=function(e,t){return this.injector.get(d).verifyTokenRequest(e.url)?t.handle(e):this.processIntercept(e,t)},e.prototype.processIntercept=function(e,t){var r,n,o=this,i=e.clone();return r=f(this.request(i),function(e){return t.handle(e)}),n=function(e){return o.responseError(i,e)},a._catch.call(r,n)},e.prototype.request=function(e){return this.refreshInProgress?this.delayRequest(e):this.addToken(e)},e.prototype.responseError=function(e,t){var r=this,n=this.injector.get(d),o=n.refreshShouldHappen(t);return o&&!this.refreshInProgress&&(this.refreshInProgress=!0,n.refreshToken().subscribe(function(){r.refreshInProgress=!1,r.refreshSubject.next(!0)},function(){r.refreshInProgress=!1,r.refreshSubject.next(!1)})),o&&this.refreshInProgress?this.retryRequest(e,t):i._throw(t)},e.prototype.addToken=function(r){var n=this.injector.get(d);return h(l(n.getAccessToken(),function(e){if(e){var t=void 0;return t="function"==typeof n.getHeaders?n.getHeaders(e):{Authorization:"Bearer "+e},r.clone({setHeaders:t})}return r}))},e.prototype.delayRequest=function(t){var r=this;return f(h(this.refreshSubject),function(e){return e?r.addToken(t):i._throw(t)})},e.prototype.retryRequest=function(t,r){var n=this.injector.get(u.HttpClient);return f(h(this.refreshSubject),function(e){return e?n.request(t):i._throw(r||t)})},e}();j.decorators=[{type:o.Injectable}],j.ctorParameters=function(){return[{type:o.Injector}]};var P=function(){};P.decorators=[{type:o.NgModule,args:[{providers:[v,b,j,{provide:u.HTTP_INTERCEPTORS,useClass:j,multi:!0}]}]}],P.ctorParameters=function(){return[]},e.AuthService=p,e.PublicGuard=v,e.ProtectedGuard=b,e.AUTH_SERVICE=d,e.PUBLIC_FALLBACK_PAGE_URI=g,e.PROTECTED_FALLBACK_PAGE_URI=y,e.AuthModule=P,e.Éµa=j,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-auth.umd.min.js.map
